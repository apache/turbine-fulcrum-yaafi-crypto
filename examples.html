<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from xdocs/examples.xml at 14 September 2021
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <meta name="author" content="Georg Kallidis" />
    <title>Fulcrum YAAFI Crypto Library &#x2013; Fulcrum Crypto Library Examples</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://turbine.apache.org/" id="bannerLeft" title="Apache Turbine"><img src="https://turbine.apache.org/images/turbine-project.png"  alt="Apache Turbine"/></a></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 14 September 2021<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.0.2-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/fulcrum/" class="externalLink" title="Fulcrum">Fulcrum</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/" class="externalLink" title="Turbine">Turbine</a></li>
      <li class="pull-right"><a href="https://www.apache.org" class="externalLink" title="Apache">Apache</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li class="active"><a href="#"><span class="none"></span>Examples</a></li>
    <li><a href="downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Apache</li>
    <li><a href="https://www.apache.org/" class="externalLink" title="Apache Website"><span class="none"></span>Apache Website</a></li>
    <li><a href="https://www.apache.org/licenses/" class="externalLink" title="License"><span class="none"></span>License</a></li>
    <li><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works"><span class="none"></span>How the ASF works</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship"><span class="none"></span>Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
    <li><a href="https://www.apache.org/security/" class="externalLink" title="Security"><span class="none"></span>Security</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >


  
    <section>
<h2><a name="Short_Examples"></a>Short Examples</h2>
          <section>
<h3><a name="Command_line_Usage"></a>Command line Usage</h3>
              
<p>
Encrypt with default PCM the string &quot;mysecretgeheim&quot; and meta password &quot;changeit&quot;, outputs encrypted string to stdout.
                </p>
<div class="source"><pre class="prettyprint">
                
 java -classpath target/classes org.apache.fulcrum.jce.crypto.cli.CLI2 string enc changeit mysecretgeheim  
 
                </pre></div>
 
<div class="source"><pre class="prettyprint">
                
 java -jar target/fulcrum-yaafi-crypto-&lt;version&gt;.jar string enc:GCM changeit mysecretgeheim  
 
                </pre></div>
This prints out the encrypted &quot;mysecretgeheim&quot;.
 
<div class="source"><pre class="prettyprint">
                
 java -jar target/fulcrum-yaafi-crypto-&lt;version&gt;.jar string dec:GCM changeit 88f8ecc93cc921672e13862d75f90c55a4cc2d823c36e6ac3da0225e397770f45d3944f6be859fe25d053a8442313a5a2581e7edf081030e  
 
                </pre></div>
This decrypts the result to stdout and prints information (supported type, matched type ..) to system.err.
         
	
<p>CLI Usage Help:
 </p>
<div class="source"><pre class="prettyprint">
                
 java -jar target/fulcrum-yaafi-crypto-&lt;version&gt;.jar help 
 
                </pre></div>
 Information about supported cipher libs:
                
<div class="source"><pre class="prettyprint">
                
 java -jar target/fulcrum-yaafi-crypto-&lt;version&gt;.jar info 
 
                </pre></div>
	
          
<p>An example using an ant build tool and property file is provided in pom-xml with phase integration-test.
          By default running this will write the encrypted password to target/integration-test/filter-integration-test.properties and the decrypted password to target/integration-test/filtered-pw.properties. You could play with this toll on the command line providing a custom secret and meta password like this (assuming -Dskip.pw.gen=false -Dskip.pw.encrypt=false):
                </p>
<div class="source"><pre class="prettyprint"> 
                
mvn integration-test -Dtest.password=&quot;xyz&quot; -Dmeta.pw=&quot;abc&quot;  
 
                </pre></div>
         
         
         
            </section>
     <section>
<h3><a name="Code_Usage"></a>Code Usage</h3>
       
<p>
          </p>
<div class="source"><pre class="prettyprint">

    // provide target_password, meta_password
            
    char[] password = meta_password.toCharArray();
    // default
    CryptoUtilJ8 cryptoUtilJ8 = CryptoUtilJ8.getInstance();

    String result = null;
    String encryptedValue;targetValue

    try {
        encryptedValue = cryptoUtilJ8.encryptString(target_password, password);
        System.out.println(&quot;encrypted:&quot; + encryptedValue);
    } catch (GeneralSecurityException | IOException e) {
        // fail();
    }
    try {
        String encryptedValue = target_password_encrypted;
        result = cryptoUtilJ8.decryptString(encryptedValue, password);
        // should equal targetValue
        System.out.println(&quot;decrypted result:&quot; + result);
    } catch (GeneralSecurityException | IOException e) {
        ...
    }
  
              </pre></div>
           
      </section> 
   </section>
   <section>
<h2><a name="Building_a_Project"></a>Building a Project</h2>
      <section>
<h3><a name="Prepare_the_crypto-tool_with_Maven_Assembly"></a>Prepare the crypto-tool with Maven Assembly</h3>
         
<p>First we build our crypto tool as executable jar in phase initialize (i.e. very early, to use it later) and name it <i>crypto-tool</i> 
            using the assembly description saved in the file <i>build/assembly.xml</i> described below. 
            Add this into your project pom.xml file.
            </p>
<div class="source"><pre class="prettyprint">
                
&lt;plugin&gt;
    &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
    &lt;version&gt;3.3.0&lt;/version&gt;
    &lt;configuration&gt;
       &lt;finalName&gt;crypto-tool&lt;/finalName&gt;  
        &lt;archive&gt;
            &lt;manifest&gt;
                &lt;mainClass&gt;org.apache.fulcrum.jce.crypto.cli.CLI2&lt;/mainClass&gt;
            &lt;/manifest&gt;
        &lt;/archive&gt;
        &lt;descriptors&gt;
            &lt;descriptor&gt;build/assembly.xml&lt;/descriptor&gt;
          &lt;/descriptors&gt;
        &lt;appendAssemblyId&gt;false&lt;/appendAssemblyId&gt;
    &lt;/configuration&gt;
    &lt;executions&gt;
  &lt;execution&gt;
    &lt;id&gt;make-assembly&lt;/id&gt; &lt;!-- this is used for inheritance merges --&gt;
    &lt;phase&gt;initialize&lt;/phase&gt; &lt;!-- bind to the packaging phase --&gt;
    &lt;goals&gt;
      &lt;goal&gt;single&lt;/goal&gt;
    &lt;/goals&gt;
   &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
                
      </pre></div>
   
   
<p>Using this assembly description (adapted to our needs from the descriptor-ref jar-with-dependencies) the executable jar will be generated 
       in target folder and will just include fulcrum yaafi-crypto classes. 
       Here you will get a very tiny jar (build with java 8 on windows less than 45kb), as the tool has no library dependencies!
      </p>
<div class="source"><pre class="prettyprint">
                
&lt;assembly xmlns=&quot;http://maven.apache.org/ASSEMBLY/2.1.0&quot;
      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
      xsi:schemaLocation=&quot;http://maven.apache.org/ASSEMBLY/2.1.0 http://maven.apache.org/xsd/assembly-2.1.0.xsd&quot;&gt;
  &lt;id&gt;crypto-tool-jar-with-dependencies&lt;/id&gt;
  &lt;formats&gt;
    &lt;format&gt;jar&lt;/format&gt;
  &lt;/formats&gt;
  &lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;
  &lt;dependencySets&gt;
    &lt;dependencySet&gt;
      &lt;outputDirectory&gt;/&lt;/outputDirectory&gt;
      &lt;useProjectArtifact&gt;true&lt;/useProjectArtifact&gt;
      &lt;unpack&gt;true&lt;/unpack&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
      &lt;includes&gt;
        &lt;include&gt;org.apache.fulcrum:fulcrum-yaafi-crypto&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/dependencySet&gt;
  &lt;/dependencySets&gt;
&lt;/assembly&gt;
                
     </pre></div>
 
 
<p>After executing the following command the <i>crypto tool</i> is available in your project and 
   we could use it to generate an encrypted password using a master password (to be saved separately and not in the project). 
   This is done in the following step.
   </p>
<div class="source"><pre class="prettyprint">
            
 mvn initialize
               
    </pre></div>
    
  </section>
  <section>
<h3><a name="Integrate_with_Ant_Tool_-_Extended"></a>Integrate with Ant Tool - Extended</h3>
    
<p>Check the pom.xml's integration test ant calls. The following is an extended version using its own assembly, but is very similar to the integration test.</p>
    
<p>First we <i>encrypt</i> the password on the command line using our master password and after that we copy and save the encrypted password in one of our project's configuration files. 
      Running the following command will show the encrypted password.
      </p>
<div class="source"><pre class="prettyprint">
              
 java -jar target/crypto-tool.jar string enc &lt;master.pw&gt; &lt;unencrypted.password&gt;
 
       </pre></div>
       Save the encrypted password as value with key <i>password_encrypted</i> 
      in an existing configuration file of your project, which will be used later. 
      You may include this process into your build tool (by invoking target init) similar as we do it for the <i>decrypting</i> process (see below paragraph).      
   
   
<p>Use the following ant build script (windows only) and save it into <i>build/build-pw.xml</i>. This is the ant build file we use to <i>decrypt</i> the encrypted password and 
      use it while building the project. The example is configured as follows:
      The global master password is set as environment variable &quot;<i>meta.pw</i>&quot;. The already encrypted password is expected to be set in a source property file <i>source.property.path</i> 
      (i.e. configuration file of your project) as value in key <i>password_encrypted</i> .  It will be read in automatically as ant variable ${password_encrypted}. 
      The <i>decrypted</i> password will be saved to key &quot;<i>password</i>&quot; in another property file (<i>target.property.path</i>), which should not be set into version control. You may need to create it new.
      You may use the ant tool as is setting the variables in <i>.build.properties</i> or integrate it in your pom.xml build process (see below).
       </p>
<div class="source"><pre class="prettyprint">
     
&lt;project basedir=&quot;.&quot;  default=&quot;build&quot; name=&quot;build&quot;&gt;
  &lt;property environment=&quot;env&quot;/&gt;
   &lt;property file=&quot;.build.properties&quot;/&gt;  
   &lt;!-- reading from the file properties: password_encrypted, password --&gt;
   &lt;property file=&quot;${source.property.path}&quot;/&gt;
   &lt;property name=&quot;meta.pw&quot; value=&quot;${env.meta.pw}&quot;/&gt;

   &lt;target name=&quot;testjava&quot;&gt;
      &lt;echo message=&quot;executing java -version&quot;/&gt;
      &lt;exec executable=&quot;cmd&quot; dir=&quot;&quot; osfamily=&quot;windows&quot; &gt;
        &lt;arg value=&quot;/c&quot;/&gt;
         &lt;arg value=&quot;java -version&quot;/&gt;
      &lt;/exec&gt;
    &lt;/target&gt;
    
   &lt;target name=&quot;decrypt&quot;&gt;
      &lt;echo message=&quot;executing java -jar target/${jarname}.jar string dec ${meta.pw} ${password_encrypted}.&quot;/&gt;
      &lt;exec executable=&quot;cmd&quot; dir=&quot;${build.path}/../&quot; osfamily=&quot;windows&quot; resultproperty=&quot;success&quot; outputproperty=&quot;decoded.pw&quot;&gt;
        &lt;arg value=&quot;/c&quot;/&gt;
         &lt;arg value=&quot;java -jar target/${jarname}.jar string dec ${meta.pw} ${password_encrypted}&quot;/&gt;
      &lt;/exec&gt;
    &lt;/target&gt;
      
   &lt;target name=&quot;update&quot;&gt;
       &lt;echo message=&quot;updating password in properties file: ${target.property.path}.&quot;/&gt;
       &lt;propertyfile file=&quot;${target.property.path}&quot; &gt;
          &lt;entry  key=&quot;password&quot; value=&quot;${decoded.pw}&quot;/&gt;
        &lt;/propertyfile&gt;
    &lt;/target&gt;
    
   &lt;target name=&quot;encrypt&quot;&gt;
      &lt;echo message=&quot;executing java -jar target/${jarname}.jar string enc ${meta.pw} ${password}&quot;/&gt;
      &lt;exec executable=&quot;cmd&quot; dir=&quot;${build.path}/../&quot; osfamily=&quot;windows&quot; resultproperty=&quot;success&quot; outputproperty=&quot;encoded.pw&quot;&gt;
        &lt;arg value=&quot;/c&quot;/&gt;
         &lt;arg value=&quot;java -jar target/${jarname}.jar string enc ${meta.pw} ${password}&quot;/&gt;
      &lt;/exec&gt;
    &lt;/target&gt;
    
  &lt;target name=&quot;init-update&quot;&gt;
       &lt;echo message=&quot;updating password_encrypted in properties file: ${target.property.path}.&quot;/&gt;
       &lt;propertyfile file=&quot;${target.property.path}&quot; &gt;
          &lt;entry  key=&quot;password_encrypted&quot; value=&quot;${encoded.pw}&quot;/&gt;
        &lt;/propertyfile&gt;
    &lt;/target&gt;
  
  &lt;target name=&quot;clean&quot;&gt;
   &lt;echo message=&quot;cleaning up key password in propert file: ${target.property.path}.&quot;/&gt;
       &lt;propertyfile file=&quot;${target.property.path}&quot; &gt;
          &lt;entry  key=&quot;password&quot; value=&quot;&quot;/&gt;
        &lt;/propertyfile&gt;
  &lt;/target&gt;

  &lt;!-- target name=&quot;run&quot;&gt;
        &lt;echo message=&quot;test output java -jar target/${jarname}.jar string dec ${meta.pw} ${password_encrypted}.&quot;/&gt;
        &lt;java jar=&quot;./../target/${jarname}.jar&quot; fork=&quot;true&quot;&gt;
        &lt;arg value=&quot;string&quot;/&gt;
        &lt;arg value=&quot;dec&quot;/&gt;
        &lt;arg value=&quot;${meta_password}&quot;/&gt;
        &lt;arg value=&quot;${password_encrypted}&quot;/&gt;
        &lt;/java&gt;
  &lt;/target--&gt;
  
  &lt;!-- decrypt to password --&gt;
   &lt;target name=&quot;build&quot; depends=&quot;testjava, decrypt, update&quot;&gt;
  &lt;/target&gt;
  
  &lt;!-- encrypt to password_encrypted --&gt;
    &lt;target name=&quot;init&quot; depends=&quot;testjava, encrypt, init-update&quot;&gt;
  &lt;/target&gt;
  
 &lt;/project&gt;      
                
         </pre></div>
     
  </section>
  <section>
<h3><a name="Integration_ANT_Task_into_Maven_Life_cycle"></a>Integration ANT Task into Maven Life cycle</h3>
    
<p>Integrate the ant tool, check the file name and run maven command below after setting your configuration or filter files in <i>source.property.path</i> and <i>target.property.path</i>. 
    You may add another clean-up in a later life cycle phase, e.g. post-integration-test. 
    You may also simplify the process by cleaning always and using the same source and target property file.
      </p>
<div class="source"><pre class="prettyprint">
            
&lt;plugin&gt;
   &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
    &lt;version&gt;3.0.0&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;build&lt;/id&gt; 
            &lt;phase&gt;process-sources&lt;/phase&gt;
            &lt;configuration&gt;
               &lt;skip&gt;${skip.pw.gen}&lt;/skip&gt;   
               &lt;target&gt;
                &lt;ant antfile=&quot;${basedir}/build/build-pw.xml&quot; target=&quot;build&quot;&gt;
                      &lt;property name=&quot;build.path&quot; value=&quot;${basedir}/build&quot; /&gt;
                      &lt;property name=&quot;meta.pw&quot; value=&quot;${meta.pw}&quot; /&gt;&lt;!-- provided by env variable --&gt;
                       &lt;property name=&quot;jarname&quot; value=&quot;crypto-tool&quot; /&gt;&lt;!-- by default ${project.build.finalName} --&gt;
                      &lt;!-- contains encrypted password, saved in vcs: --&gt;
                      &lt;property name=&quot;source.property.path&quot; value=&quot;${basedir}/src/main/filters/${env}-app.properties&quot; /&gt;
                      &lt;!-- should NOT be saved in vcs: --&gt;
                      &lt;property name=&quot;target.property.path&quot; value=&quot;${basedir}/src/main/filters/${env}-pw.properties&quot; /&gt;
                  &lt;/ant&gt;
                &lt;/target&gt;
            &lt;/configuration&gt;
            &lt;goals&gt;
              &lt;goal&gt;run&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
        &lt;execution&gt;
            &lt;id&gt;clean&lt;/id&gt; 
            &lt;phase&gt;clean&lt;/phase&gt;
            &lt;configuration&gt;
                &lt;skip&gt;${skip.pw.gen}&lt;/skip&gt;
               &lt;target&gt;
                &lt;ant antfile=&quot;${basedir}/build/build-pw.xml&quot; target=&quot;clean&quot;&gt;
                      &lt;property name=&quot;build.path&quot; value=&quot;${basedir}/build&quot; /&gt;
                      &lt;property name=&quot;target.property.path&quot; value=&quot;${basedir}/src/main/filters/filter-${env}-pw.properties&quot; /&gt;
                  &lt;/ant&gt;
                &lt;/target&gt;
            &lt;/configuration&gt;
            &lt;goals&gt;
              &lt;goal&gt;run&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
  &lt;/plugin&gt;
            
       </pre></div>
   You may add another  execution definiton with id and target &quot;init&quot; and probably another skip property to initially or regularily update the encoded password.
     
  </section>
  <section>
<h3><a name="Maven_Command_line_examples"></a>Maven Command line examples</h3>
     
<p>Save the decrypted password for the build
         </p>
<div class="source"><pre class="prettyprint">
                
mvn clean test -Dmeta.pw=&lt;securepwd&gt;
                
                </pre></div>
                    
              
<p>Keep the unencrypted password in source property files to use it during development or later (you may add a profile).
                </p>
<div class="source"><pre class="prettyprint">
                
mvn clean test install -Dskip.pw.gen=true
                
                </pre></div>
                    
 
<p>Clean up finally.
                </p>
<div class="source"><pre class="prettyprint">
                
mvn clean 
               
        </pre></div>
    
    
<p>This example could be extended or adapted, eg. by using multiple passwords, or encrypting an entire file. 
       Have fun!
    </p>

    </section>
   </section>

  


        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2008&#x2013;2021
<a href="https://www.apache.org/">The Apache Software Foundation</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
